# [DA] Cohort ë¶„ì„

### ðŸ“Cohort ë¶„ì„

- **ì½”í˜¸íŠ¸ëž€ ?** íŠ¹ì • ê¸°ê°„ ë™ì•ˆ ê³µí†µëœ íŠ¹ì„±ì´ë‚˜ ê²½í—˜ì„ ê°–ëŠ” ì‚¬ìš©ìž ì§‘ë‹¨ì„ ì˜ë¯¸
- **ì½”í˜¸íŠ¸ ë¶„ì„ ?** ì‹œê°„ì„ ë‘ê³  ë¹„ìŠ·í•œ ê·¸ë£¹ì„ ë¹„êµí•˜ëŠ” ë°©ë²•
- ex.
    - ìµœê·¼ ìœ ìž… ê³ ê°ì˜ ê°€ìž…ì „í™˜ìœ¨ì´ ë‚®ì•„ì§
        
        â†’ ê´‘ê³ ì±„ë„ë³„ ìœ ìž…ê³ ê° ì½”í˜¸íŠ¸ ë¶„ì„
        
    - ì²« êµ¬ë§¤ íŠ¹ê°€ìƒí’ˆ í”„ë¡œëª¨ì…˜ ì§„í–‰ ì—¬ë¶€ ê³ ë¯¼ì¤‘
        
        â†’ ì²« êµ¬ë§¤ íŠ¹ê°€ìƒí’ˆ êµ¬ë§¤ ì—¬ë¶€ì— ë”°ë¼ ì½”í˜¸íŠ¸ ë¶„ì„ 
        
        ![ì „ì²´ë¡œ ë³´ë©´ ë¦¬í…ì…˜ì´ ë–¨ì–´ì ¸ë„ ì–´ë””ê°€ ë¬¸ì œì¸ì§€ íŒŒì•… ì–´ë ¤ì›€
        ì½”í˜¸íŠ¸ ë¶„ì„ì„ í•˜ë©´ ì–´ëŠ ì‹œì ì— ì–´ëŠ ê·¸ë£¹ì— ë¬¸ì œê°€ ìžˆëŠ”ì§€ í™•ì¸ ê°€ëŠ¥](cohort1.png1)
                
    

### ðŸ“AARRR(í•´ì ì§€í‘œ)

- **ê·¸ë¡œìŠ¤ í•´í‚¹ ?** ì‚¬ì—…ì˜ í•µì‹¬ì§€í‘œë¥¼ ë°œêµ´í•˜ê³ , ì„±ìž¥ì‹œí‚¤ëŠ” ë°©ë²•ì„ ì°¾ëŠ” í™œë™
- AARRRì€ ì‚¬ìš©ìž í–‰ë™ë°©ì‹ 5ë‹¨ê³„ ì§€í‘œ
    
    ```python
    ì‚¬ìš©ìž ìœ ì¹˜(Acquisition)
    	-> ì‚¬ìš©ìž í™œì„±í™”(Activation)
    		-> ì‚¬ìš©ìž ìœ ì§€(Retention)
    			-> ì¶”ì²œ(Referral)
    				-> ë§¤ì¶œ(Revenue)
    				
    * í™œì„±í™”ì™€ ìœ ì§€ìœ¨ì´ ê°€ìž¥ ë¨¼ì € ê°œì„  í•„ìš”! 
    ```
    

### ðŸ“ë¦¬í…ì…˜ì—Â ëŒ€í•œ ì´í•´

- ë¦¬í…ì…˜ ? ê³ ê° ìœ ì§€ìœ¨ë¡œ ì„œë¹„ìŠ¤ì˜ ì„±ê³µì„ ì˜ˆì¸¡í•  ìˆ˜ ìžˆëŠ” ê°€ìž¥ ê¸°ë³¸ì ì¸ í•µì‹¬ ì§€í‘œ
- ë¦¬í…ì…˜ ì¸¡ì • ë°©ë²•
    - íŠ¹ì • ê¸°ê°„ ë‚´ì— ì´ë²¤íŠ¸ë¥¼ ë°œìƒì‹œí‚¨ ìœ ì €ì˜ ë¹„ìœ¨ì„ ê³„ì‚°
    - ê¸°ê°„ ë‚´ 1ë²ˆ ì´ìƒì˜ ì´ë²¤íŠ¸ê°€ ê´€ì¸¡ë˜ë©´ í•œ ë²ˆìœ¼ë¡œ ì¹´ìš´íŠ¸
    - **Retention = ì¸¡ì • Week ê¸°ê°„ ë‚´ ì„œë¹„ìŠ¤ ì´ìš© ê³ ê° ìˆ˜ / Week1 ì„œë¹„ìŠ¤ ì´ìš© ê³ ê° ìˆ˜**
        
        ![cohort2](cohort2.png)
        
    - Retentionì„ ëˆ„ì  ì‚¬ìš©ìžë§Œ ë³¼ì§€, ì•„ë‹ì§€ëŠ” ë³´ê³ ìž í•˜ëŠ” ë°ì´í„°ì˜ ì„±ê²©ì— ë§žê²Œ ì„¤ì •

### ðŸ“ë¬¸ì œì¸ì‹Â ~ ê°€ì„¤ìˆ˜ë¦½ ~ ê²°ë¡ ë„ì¶œ

1. ì£¼ì œ
    - ì²«êµ¬ë§¤ íŠ¹ê°€ìƒí’ˆì„ êµ¬ë§¤í•œ ê³ ê°ì´ ìœ ì§€ê°€ ë” ìž˜ ë  ê²ƒì¸ê°€ ?
2. ë¬¸ì œì¸ì‹ ë°°ê²½
    - ì²«êµ¬ë§¤ íŠ¹ê°€ìƒí’ˆ í”„ë¡œëª¨ì…˜ì€ íƒ€ ë§ˆì¼€íŒ… í™œë™ ëŒ€ë¹„ ê³ ê°íšë“ë¹„ìš©(CAC)ê°€ ë¹„ì‹¸ë‹¤.
    - ê·¸ëŸ¼ì—ë„ ì²«êµ¬ë§¤ íŠ¹ê°€ìƒí’ˆ í”„ë¡œëª¨ì…˜ì€ ê³ ê°ì—ê²Œ ì²«ì¸ìƒì„ ì¢‹ê²Œ ë‚¨ê²¨ì£¼ì–´ ìž”ì¡´ ê°€ëŠ¥ì„±ì´ ë” ë†’ì„ ê²ƒ ê°™ì€ë° ðŸ¤”
    - í•œíŽ¸ìœ¼ë¡œëŠ” ì´ë¥¼ ì•…ì´ìš©í•˜ëŠ” ì²´ë¦¬í”¼ì»¤ ê³ ê°ë§Œ ë°ë¦¬ê³  ì˜¤ëŠ” ê²ƒì€ ì•„ë‹Œì§€ ê±±ì •ë„ ë¨ ðŸ™„
    - í•´ë‹¹ í”„ë¡œëª¨ì…˜ì„ ìœ ì§€í•´ì•¼ í• ì§€ ë§ì•„ì•¼ í• ì§€ ê³ ë¯¼í•˜ê³  ìžˆì§€ë§Œ ì˜ì‚¬ê²°ì •ì„ ìœ„í•œ ëª…í™•í•œ ê·¼ê±°ê°€ ì—†ëŠ” ìƒí™©
3. ë°ì´í„°
    1. ê°€ì„¤ìˆ˜ë¦½: ì²«êµ¬ë§¤ íŠ¹ê°€ìƒí’ˆ êµ¬ë§¤ ê³ ê°ì€ ë¦¬í…ì…˜ì´ ë” ë†’ì„ ê²ƒì´ë‹¤.
    2. ì¢…ì†ë³€ìˆ˜: ê³ ê° ìœ ì§€ìœ¨(ë¦¬í…ì…˜)
    3. ë…ë¦½ë³€ìˆ˜: ì²«êµ¬ë§¤ íŠ¹ê°€ìƒí’ˆ êµ¬ë§¤ ì—¬ë¶€(1: êµ¬ë§¤ / 0: ë¯¸êµ¬ë§¤)
    4. ì¸¡ì •ì¸ì›: ì²«êµ¬ë§¤ íŠ¹ê°€ìƒí’ˆ êµ¬ë§¤ìž 1,000ëª… / ë¯¸êµ¬ë§¤ìž 1,000ëª…
    5. ê¸°ì¤€ê¸°ê°„: 1ì›” í•œ ë‹¬ê°„ ì²«êµ¬ë§¤ ê³ ê°(1ì›” w1 ì£¼ë¬¸ê³ ê° ê¸°ì¤€ìœ¼ë¡œ w4ê¹Œì§€ ë¦¬í…ì…˜ ë¹„êµ)
4. sql ë°ì´í„° ë¶„ì„

```sql
-- ì²« ì£¼ë¬¸ í…Œì´ë¸” 
select * from first_ord_table; 

-- ì˜¤ë”ë§ˆìŠ¤í„° í…Œì´ë¸”
select * from order_master_cohort ; 

-- ë‘ í…Œì´ë¸” ì¡°ì¸
select * 
from first_ord_table fot 
left join order_master_cohort omc 
on fot.mem_no = omc.mem_no ;

-- ì½”í˜¸íŠ¸ ë¶„ì„ì— í•„ìš”í•œ ë°ì´í„° ì§‘ê³„
with t1 as (  
select distinct fot.mem_no,
       is_promotion,
       CASE 
           WHEN ord_dt = first_ord_dt THEN 0 
           WHEN ord_dt > first_ord_dt AND ord_dt <= DATE_ADD(first_ord_dt, INTERVAL 7 DAY) THEN 1
           WHEN ord_dt > DATE_ADD(first_ord_dt, INTERVAL 7 DAY) 
                AND ord_dt <= DATE_ADD(first_ord_dt, INTERVAL 14 DAY) THEN 2
           WHEN ord_dt > DATE_ADD(first_ord_dt, INTERVAL 14 DAY) 
                AND ord_dt <= DATE_ADD(first_ord_dt, INTERVAL 21 DAY) THEN 3
           WHEN ord_dt > DATE_ADD(first_ord_dt, INTERVAL 21 DAY) 
                AND ord_dt <= DATE_ADD(first_ord_dt, INTERVAL 28 DAY) THEN 4
           ELSE NULL 
       END AS week_num  # ì²« ì£¼ë¬¸ì¼ ê¸°ì¤€ 7,14,21,28ì¼ ì´ë‚´ë¥¼ week_num ë„˜ë²„ë§
from first_ord_table fot 
left join order_master_cohort omc 
on fot.mem_no = omc.mem_no
)
, t2 as (
select is_promotion
	, mem_no
	, week_num  
	, row_number() over (partition by mem_no order by week_num) as seq
from t1
where week_num is not null 
order by 1,2,3,4 
)

select is_promotion
	, case when week_num = 0 then '1.w-0'
		   when week_num = 1 and seq = 2 then '2.w-1'
		   when week_num = 2 and seq = 3 then '3.w-2'
		   when week_num = 3 and seq = 4 then '4.w-3'
		   when week_num = 4 and seq = 5 then '5.w-4'
		   end as week_range
	, count(mem_no) as mem_cnt
from t2
group by 1,2 
order by 1,2 ;
```

5. ê²°ë¡ ë„ì¶œ
    
    ![W-0 ì»¬ëŸ¼ 1,000ì€ ëª¨ìˆ˜ë¥¼ ì ì–´ì¤Œ ](cohort3.png)
        
    - íŠ¹ê°€ìƒí’ˆ êµ¬ë§¤ ì½”í˜¸íŠ¸ê°€ 1ì£¼ê°€ ì§€ë‚œ ì‹œì ë¶€í„° ë†’ì€ ë¦¬í…ì…˜ì„ ë³´ìž„
        - êµ¬ë§¤í•œ ê³ ê°ê³¼  êµ¬ë§¤ ì•ˆ í•œ ê³ ê° ì°¨ì´ê°€ 20%ì´ìƒì˜ í° ì°¨ì´. ìœ ì˜ë¯¸í•œ ì°¨ì´.
    - ì²«êµ¬ë§¤ íŠ¹ê°€ìƒí’ˆ í”„ë¡œëª¨ì…˜ì„ ìœ ì§€í•˜ëŠ” ë°©í–¥ìœ¼ë¡œ ì˜ì‚¬ê²°ì •